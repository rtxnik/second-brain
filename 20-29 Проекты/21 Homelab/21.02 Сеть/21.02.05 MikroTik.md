# 21.02.05 MikroTik

> Конфигурация managed switch

## Общая информация

| Параметр      | Значение                  |
| ------------- | ------------------------- |
| Модель        | CSS318-16G-2S+IN          |
| Порты         | 16x GbE + 2x SFP+ 10G     |
| OS            | SwOS                      |
| Management IP | 10.0.10.254 (планируется) |

---

## VLAN конфигурация

### VLANs

| VLAN ID | Название   | Назначение          |
| ------- | ---------- | ------------------- |
| 10      | Management | Proxmox, управление |
| 20      | Services   | K8s, DNS, сервисы   |
| 30      | Storage    | NFS, PBS            |
| 40      | IoT        | Raspberry Pi        |
| 50      | DMZ        | Exposed services    |

### Порты

| Порт  | Режим  | PVID | VLANs          | Подключение         |
| ----- | ------ | ---- | -------------- | ------------------- |
| 1     | Access | 1    | -              | Keenetic uplink     |
| 2     | Trunk  | 1    | 10,20,30,40,50 | OPNsense LAN        |
| 3     | Trunk  | 10   | 10,20,30,40,50 | pve-compute-01 eth0 |
| 4     | Trunk  | 10   | 10,20,30,40,50 | pve-compute-02 eth0 |
| 5     | Trunk  | 10   | 10,20,30,40,50 | pve-compute-03 eth0 |
| 6     | -      | -    | -              | [свободен]          |
| 7     | Access | 1    | untagged       | pve-compute-01 eth1 |
| 8     | Access | 1    | untagged       | pve-compute-02 eth1 |
| 9     | Access | 1    | untagged       | pve-compute-03 eth1 |
| 10-16 | -      | -    | -              | [свободны]          |

---

## Конфигурация SwOS

### Создание VLANs

```
VLAN → VLAN → Add:
  VLAN ID: 10, 20, 30, 40, 50
```

### Настройка Trunk портов (2-5)

```
VLAN → Port Isolation:
  Port 2-5:
    VLAN Mode: Enabled
    VLAN Receive: Only tagged
    Default VLAN ID: 10
    Force VLAN ID: Disabled

VLAN → VLAN:
  VLAN 10: Ports 2,3,4,5 = Tagged
  VLAN 20: Ports 2,3,4,5 = Tagged
  VLAN 30: Ports 2,3,4,5 = Tagged
  VLAN 40: Ports 2,3,4,5 = Tagged
  VLAN 50: Ports 2,3,4,5 = Tagged
```

### Настройка Access портов (7-9)

```
VLAN → Port Isolation:
  Port 7-9:
    VLAN Mode: Disabled (untagged traffic)
    Default VLAN ID: 1
```

---

## Проверка конфигурации

```bash
# С Proxmox ноды - проверить что VM получают IP в нужном VLAN
ip addr show

# Создать тестовую VM в VLAN 20
# Должна получить IP из 10.0.20.100-200
```

---

## TODO

- [ ] Настроить Management IP (10.0.10.254)
- [ ] IGMP Snooping (опционально)
- [ ] Сохранить финальную конфигурацию

---

## Полезные ссылки

- [SwOS Manual](https://help.mikrotik.com/docs/display/SWOS/SwOS)
- [MikroTik VLAN Guide](https://wiki.mikrotik.com/wiki/SwOS/CSS326)

---

Дата создания: 02-12-2025 18:22

#### Ссылки:

[[21.02.00 Сеть]]
[[21.01.02 Сетевое оборудование]]
