# 21.02.01 VLAN архитектура

> Структура сетевой сегментации

## VLANs

| VLAN | Сеть         | Gateway   | Назначение            |
| ---- | ------------ | --------- | --------------------- |
| 10   | 10.0.10.0/24 | 10.0.10.1 | Management            |
| 20   | 10.0.20.0/24 | 10.0.20.1 | Services / Kubernetes |
| 30   | 10.0.30.0/24 | 10.0.30.1 | Storage               |
| 40   | 10.0.40.0/24 | 10.0.40.1 | IoT / Raspberry Pi    |
| 50   | 10.0.50.0/24 | 10.0.50.1 | DMZ                   |

**Cluster Network (без VLAN):** 10.0.11.0/24

---

## Назначение VLANs

### VLAN 10 - Management

```
Proxmox Web UI, SSH доступ к хостам
Изолирован от production трафика
```

**Устройства:**

- pve-compute-01/02/03
- OPNsense management
- MikroTik management
- TrueNAS management

### VLAN 20 - Services

```
Kubernetes VMs, DNS серверы, инфраструктурные сервисы
Основная рабочая сеть
```

**Устройства:**

- DNS серверы (dns-01, dns-02)
- K8s Production cluster
- K8s Test cluster
- Инфраструктурные VM

### VLAN 30 - Storage

```
NFS, iSCSI, Proxmox Backup Server
Выделенная сеть для storage трафика
```

**Устройства:**

- TrueNAS (primary interface)
- PBS (Proxmox Backup Server)

### VLAN 40 - IoT

```
Raspberry Pi, умные устройства
Изолирован от основной инфраструктуры
```

### VLAN 50 - DMZ

```
Сервисы с внешним доступом
Максимальная изоляция
```

---

## Cluster Network (10.0.11.0/24)

```
Выделенная сеть для:
- Proxmox Corosync (cluster communication)
- Ceph OSD/MON трафик

Без VLAN тегов - прямое подключение через USB Ethernet
```

---

## Схема трафика

```
┌──────────────────────────────────────────────────┐
│                    OPNsense                       │
│              (Inter-VLAN Routing)                 │
└───────┬───────┬───────┬───────┬───────┬──────────┘
        │       │       │       │       │
     VLAN10  VLAN20  VLAN30  VLAN40  VLAN50
        │       │       │       │       │
     Mgmt   Services Storage   IoT    DMZ
```

---

Дата создания: 02-12-2025 18:22

#### Ссылки:

[[21.02.00 Сеть]]
[[21.02.02 IP адресация]]
