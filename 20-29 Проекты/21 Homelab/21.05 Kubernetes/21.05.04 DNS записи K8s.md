# 21.05.04 DNS записи K8s

> Полный список DNS записей для Kubernetes кластеров

## Зона k8s.rtxlab.local

Файл: `/etc/bind/zones/db.k8s.rtxlab.local` на dns-01

```bind
$TTL    86400
@       IN      SOA     dns-01.rtxlab.local. admin.rtxlab.local. (
                        2025120201      ; Serial (УВЕЛИЧИТЬ ПРИ ИЗМЕНЕНИЯХ!)
                        3600            ; Refresh
                        1800            ; Retry
                        604800          ; Expire
                        86400 )         ; Negative Cache TTL

; Name servers
@       IN      NS      dns-01.rtxlab.local.
@       IN      NS      dns-02.rtxlab.local.

; ============================================================
; PRODUCTION CLUSTER (10.0.20.20-39)
; ============================================================

; Control Plane
k8s-prod-master-1       IN      A       10.0.20.20
k8s-prod-master-2       IN      A       10.0.20.21
k8s-prod-master-3       IN      A       10.0.20.22

; API VIP (HA endpoint)
k8s-prod-api            IN      A       10.0.20.25
api.prod                IN      CNAME   k8s-prod-api.k8s.rtxlab.local.

; Ingress
k8s-prod-ingress-1      IN      A       10.0.20.30

; Workers
k8s-prod-worker-1       IN      A       10.0.20.31
k8s-prod-worker-2       IN      A       10.0.20.32

; Wildcard для Production apps
*.apps.prod             IN      A       10.0.20.30

; ============================================================
; TEST CLUSTER (10.0.20.40-59)
; ============================================================

; Control Plane
k8s-test-master-1       IN      A       10.0.20.40
k8s-test-master-2       IN      A       10.0.20.41
k8s-test-master-3       IN      A       10.0.20.42

; API VIP (HA endpoint)
k8s-test-api            IN      A       10.0.20.45
api.test                IN      CNAME   k8s-test-api.k8s.rtxlab.local.

; Ingress
k8s-test-ingress-1      IN      A       10.0.20.50

; Workers
k8s-test-worker-1       IN      A       10.0.20.51
k8s-test-worker-2       IN      A       10.0.20.52

; Wildcard для Test apps
*.apps.test             IN      A       10.0.20.50
```

---

## Обратная зона (PTR)

Файл: `/etc/bind/zones/db.20.0.10` на dns-01

```bind
$TTL    86400
@       IN      SOA     dns-01.rtxlab.local. admin.rtxlab.local. (
                        2025120201      ; Serial
                        3600            ; Refresh
                        1800            ; Retry
                        604800          ; Expire
                        86400 )         ; Negative Cache TTL

@       IN      NS      dns-01.rtxlab.local.
@       IN      NS      dns-02.rtxlab.local.

; Production Cluster PTR
20      IN      PTR     k8s-prod-master-1.k8s.rtxlab.local.
21      IN      PTR     k8s-prod-master-2.k8s.rtxlab.local.
22      IN      PTR     k8s-prod-master-3.k8s.rtxlab.local.
25      IN      PTR     k8s-prod-api.k8s.rtxlab.local.
30      IN      PTR     k8s-prod-ingress-1.k8s.rtxlab.local.
31      IN      PTR     k8s-prod-worker-1.k8s.rtxlab.local.
32      IN      PTR     k8s-prod-worker-2.k8s.rtxlab.local.

; Test Cluster PTR
40      IN      PTR     k8s-test-master-1.k8s.rtxlab.local.
41      IN      PTR     k8s-test-master-2.k8s.rtxlab.local.
42      IN      PTR     k8s-test-master-3.k8s.rtxlab.local.
45      IN      PTR     k8s-test-api.k8s.rtxlab.local.
50      IN      PTR     k8s-test-ingress-1.k8s.rtxlab.local.
51      IN      PTR     k8s-test-worker-1.k8s.rtxlab.local.
52      IN      PTR     k8s-test-worker-2.k8s.rtxlab.local.
```

---

## Сводная таблица

### Production Cluster

| Hostname                            | IP         | Назначение   |
| ----------------------------------- | ---------- | ------------ |
| k8s-prod-master-1.k8s.rtxlab.local  | 10.0.20.20 | Master 1     |
| k8s-prod-master-2.k8s.rtxlab.local  | 10.0.20.21 | Master 2     |
| k8s-prod-master-3.k8s.rtxlab.local  | 10.0.20.22 | Master 3     |
| k8s-prod-api.k8s.rtxlab.local       | 10.0.20.25 | API VIP      |
| k8s-prod-ingress-1.k8s.rtxlab.local | 10.0.20.30 | Ingress      |
| k8s-prod-worker-1.k8s.rtxlab.local  | 10.0.20.31 | Worker 1     |
| k8s-prod-worker-2.k8s.rtxlab.local  | 10.0.20.32 | Worker 2     |
| \*.apps.prod.k8s.rtxlab.local       | 10.0.20.30 | Applications |

### Test Cluster

| Hostname                            | IP         | Назначение   |
| ----------------------------------- | ---------- | ------------ |
| k8s-test-master-1.k8s.rtxlab.local  | 10.0.20.40 | Master 1     |
| k8s-test-master-2.k8s.rtxlab.local  | 10.0.20.41 | Master 2     |
| k8s-test-master-3.k8s.rtxlab.local  | 10.0.20.42 | Master 3     |
| k8s-test-api.k8s.rtxlab.local       | 10.0.20.45 | API VIP      |
| k8s-test-ingress-1.k8s.rtxlab.local | 10.0.20.50 | Ingress      |
| k8s-test-worker-1.k8s.rtxlab.local  | 10.0.20.51 | Worker 1     |
| k8s-test-worker-2.k8s.rtxlab.local  | 10.0.20.52 | Worker 2     |
| \*.apps.test.k8s.rtxlab.local       | 10.0.20.50 | Applications |

---

## Применение изменений

```bash
# 1. SSH на dns-01
ssh admin@10.0.20.11

# 2. Редактировать зону
sudo nano /etc/bind/zones/db.k8s.rtxlab.local

# 3. УВЕЛИЧИТЬ Serial!

# 4. Проверить
sudo named-checkzone k8s.rtxlab.local /etc/bind/zones/db.k8s.rtxlab.local

# 5. Применить
sudo rndc reload k8s.rtxlab.local

# 6. Проверить на slave
ssh admin@10.0.20.12
sudo rndc retransfer k8s.rtxlab.local
dig @127.0.0.1 k8s.rtxlab.local SOA +short
```

---

## Тестирование

```bash
# Forward lookup
dig @10.0.20.11 k8s-prod-api.k8s.rtxlab.local +short
# Ожидаем: 10.0.20.25

# Wildcard test
dig @10.0.20.11 grafana.apps.prod.k8s.rtxlab.local +short
# Ожидаем: 10.0.20.30

# Reverse lookup
dig @10.0.20.11 -x 10.0.20.25 +short
# Ожидаем: k8s-prod-api.k8s.rtxlab.local.
```

---

Дата создания: 02-12-2025 18:22

#### Ссылки:

[[21.05.00 Kubernetes]]
[[21.04.00 DNS]]
[[21.04.02 DNS Шпаргалка]]
