# 21.05.00 Kubernetes

> Kubernetes кластеры для homelab

## Содержание

| Заметка                         | Описание                            |
| ------------------------------- | ----------------------------------- |
| [[21.05.01 Production Cluster]] | Prod кластер — полные ресурсы       |
| [[21.05.02 Test Cluster]]       | Test кластер — зеркальная топология |
| [[21.05.03 Kubespray]]          | Inventory и настройки деплоя        |
| [[21.05.04 DNS записи K8s]]     | DNS записи для обоих кластеров      |

---

## Обзор

```
┌─────────────────────────────────────────────────────────────────┐
│                    Kubernetes Infrastructure                     │
├────────────────────────────────┬────────────────────────────────┤
│       Production Cluster       │         Test Cluster           │
│                                │                                │
│   3x Masters (8GB, 4 vCPU)     │   3x Masters (4GB, 2 vCPU)     │
│   1x Ingress (4GB, 2 vCPU)     │   1x Ingress (2GB, 2 vCPU)     │
│   2x Workers (24GB, 6 vCPU)    │   2x Workers (8GB, 4 vCPU)     │
│                                │                                │
│   API VIP: 10.0.20.25          │   API VIP: 10.0.20.45          │
│   Ingress: 10.0.20.30          │   Ingress: 10.0.20.50          │
│   Apps: *.apps.prod            │   Apps: *.apps.test            │
└────────────────────────────────┴────────────────────────────────┘
```

---

## Зачем два кластера?

| Аспект       | Описание                               |
| ------------ | -------------------------------------- |
| Тестирование | Проверка изменений перед prod          |
| Обучение     | Эксперименты без риска                 |
| CI/CD        | Deploy в test → promote в prod         |
| Идентичность | Одинаковая топология = предсказуемость |

---

## Инструменты

| Инструмент | Назначение                 |
| ---------- | -------------------------- |
| Kubespray  | Деплой кластеров (Ansible) |
| kubectl    | CLI управление             |
| k9s        | TUI для K8s                |
| Helm       | Package manager            |
| ArgoCD     | GitOps                     |

---

## Сводка ресурсов

### Production

| Компонент | RAM      | vCPU   | Disk      | Кол-во |
| --------- | -------- | ------ | --------- | ------ |
| Master    | 8GB      | 4      | 50GB      | 3      |
| Ingress   | 4GB      | 2      | 30GB      | 1      |
| Worker    | 24GB     | 6      | 100GB     | 2      |
| **Итого** | **76GB** | **26** | **380GB** | **6**  |

### Test

| Компонент | RAM      | vCPU   | Disk      | Кол-во |
| --------- | -------- | ------ | --------- | ------ |
| Master    | 4GB      | 2      | 30GB      | 3      |
| Ingress   | 2GB      | 2      | 20GB      | 1      |
| Worker    | 8GB      | 4      | 50GB      | 2      |
| **Итого** | **30GB** | **16** | **210GB** | **6**  |

---

## Статус

- [ ] VM template готов
- [ ] VMs развёрнуты через OpenTofu
- [ ] DNS записи добавлены
- [ ] SSH доступ настроен
- [ ] Test cluster развёрнут (Kubespray)
- [ ] Production cluster развёрнут
- [ ] Ingress Controller установлен
- [ ] Longhorn установлен

---

Дата создания: 02-12-2025 18:22

#### Ссылки:

[[21.00 Homelab]]
[[21.03.03 VM Templates]]
