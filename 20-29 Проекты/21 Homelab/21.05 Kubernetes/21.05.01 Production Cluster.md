# 21.05.01 Production Cluster

> Kubernetes Production кластер с полными ресурсами

## Топология

```
┌─────────────────────────────────────────────────────────────┐
│                   Production K8s Cluster                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│   │  Master-1   │  │  Master-2   │  │  Master-3   │        │
│   │ 10.0.20.20  │  │ 10.0.20.21  │  │ 10.0.20.22  │        │
│   │ etcd + CP   │  │ etcd + CP   │  │ etcd + CP   │        │
│   └──────┬──────┘  └──────┬──────┘  └──────┬──────┘        │
│          │                │                │                │
│          └────────────────┼────────────────┘                │
│                           │                                 │
│                    ┌──────┴──────┐                          │
│                    │   API VIP   │                          │
│                    │ 10.0.20.25  │                          │
│                    └─────────────┘                          │
│                                                             │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│   │  Ingress-1  │  │  Worker-1   │  │  Worker-2   │        │
│   │ 10.0.20.30  │  │ 10.0.20.31  │  │ 10.0.20.32  │        │
│   │  *.apps.prod│  │  Workloads  │  │  Workloads  │        │
│   └─────────────┘  └─────────────┘  └─────────────┘        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Ноды

| Hostname           | IP         | Роль                 | RAM  | vCPU | Disk  |
| ------------------ | ---------- | -------------------- | ---- | ---- | ----- |
| k8s-prod-master-1  | 10.0.20.20 | Control Plane + etcd | 8GB  | 4    | 50GB  |
| k8s-prod-master-2  | 10.0.20.21 | Control Plane + etcd | 8GB  | 4    | 50GB  |
| k8s-prod-master-3  | 10.0.20.22 | Control Plane + etcd | 8GB  | 4    | 50GB  |
| k8s-prod-ingress-1 | 10.0.20.30 | Ingress Controller   | 4GB  | 2    | 30GB  |
| k8s-prod-worker-1  | 10.0.20.31 | Workloads            | 24GB | 6    | 100GB |
| k8s-prod-worker-2  | 10.0.20.32 | Workloads            | 24GB | 6    | 100GB |

**Итого:** 76GB RAM, 26 vCPU, 380GB disk

---

## Ключевые адреса

| Назначение    | Адрес                         |
| ------------- | ----------------------------- |
| API VIP (HA)  | 10.0.20.25                    |
| Ingress VIP   | 10.0.20.30                    |
| Wildcard Apps | \*.apps.prod.k8s.rtxlab.local |

---

## DNS записи

```bind
; Production K8s Cluster
k8s-prod-master-1    IN  A   10.0.20.20
k8s-prod-master-2    IN  A   10.0.20.21
k8s-prod-master-3    IN  A   10.0.20.22
k8s-prod-api         IN  A   10.0.20.25
k8s-prod-ingress-1   IN  A   10.0.20.30
k8s-prod-worker-1    IN  A   10.0.20.31
k8s-prod-worker-2    IN  A   10.0.20.32

; Wildcard для apps
*.apps.prod          IN  A   10.0.20.30
```

---

## Компоненты

| Компонент         | Решение              | Статус |
| ----------------- | -------------------- | ------ |
| Container Runtime | containerd           | [ ]    |
| CNI               | Calico               | [ ]    |
| Ingress           | NGINX Ingress        | [ ]    |
| Load Balancer     | MetalLB              | [ ]    |
| Storage           | Longhorn             | [ ]    |
| GitOps            | ArgoCD               | [ ]    |
| Monitoring        | Prometheus + Grafana | [ ]    |
| Logging           | Loki                 | [ ]    |

---

## Доступ

### kubectl

```bash
# Скопировать kubeconfig
scp admin@k8s-prod-master-1:~/.kube/config ~/.kube/config-prod

# Использовать
export KUBECONFIG=~/.kube/config-prod
kubectl get nodes
```

### k9s

```bash
KUBECONFIG=~/.kube/config-prod k9s
```

---

## Статус

- [ ] VMs созданы
- [ ] DNS записи добавлены
- [ ] Kubespray выполнен
- [ ] Кластер работает
- [ ] Ingress настроен
- [ ] Storage готов

---

Дата создания: 02-12-2025 18:22

#### Ссылки:

[[21.05.00 Kubernetes]]
[[21.05.03 Kubespray]]
