# 21.04.03 DNS Шаблоны

> Шаблоны конфигурации зон BIND9

## Шаблон прямой зоны

```bind
$TTL    86400
@       IN      SOA     dns-01.rtxlab.local. admin.rtxlab.local. (
                        YYYYMMDDNN      ; Serial (ОБЯЗАТЕЛЬНО МЕНЯТЬ!)
                        3600            ; Refresh (1 hour)
                        1800            ; Retry (30 minutes)
                        604800          ; Expire (1 week)
                        86400 )         ; Negative Cache TTL (1 day)

; Name servers
@       IN      NS      dns-01.rtxlab.local.
@       IN      NS      dns-02.rtxlab.local.

; A records
hostname        IN      A       10.0.20.X
another-host    IN      A       10.0.20.Y

; CNAME records
alias           IN      CNAME   hostname.zone.rtxlab.local.

; Wildcard
*.subdomain     IN      A       10.0.20.Z
```

---

## Шаблон обратной зоны

```bind
$TTL    86400
@       IN      SOA     dns-01.rtxlab.local. admin.rtxlab.local. (
                        YYYYMMDDNN      ; Serial (ОБЯЗАТЕЛЬНО МЕНЯТЬ!)
                        3600            ; Refresh
                        1800            ; Retry
                        604800          ; Expire
                        86400 )         ; Negative Cache TTL

; Name servers
@       IN      NS      dns-01.rtxlab.local.
@       IN      NS      dns-02.rtxlab.local.

; PTR records
; Формат: последний_октет    IN    PTR    полное.имя.
11      IN      PTR     dns-01.rtxlab.local.
12      IN      PTR     dns-02.rtxlab.local.
30      IN      PTR     hostname.zone.rtxlab.local.
```

---

## named.conf.local — Master

```c
zone "example.rtxlab.local" {
    type master;
    file "/etc/bind/zones/db.example.rtxlab.local";
    allow-transfer { 10.0.20.12; };
    notify yes;
};

zone "X.Y.10.in-addr.arpa" {
    type master;
    file "/etc/bind/zones/db.X.Y.10";
    allow-transfer { 10.0.20.12; };
    notify yes;
};
```

---

## named.conf.local — Slave

```c
zone "example.rtxlab.local" {
    type slave;
    file "/var/cache/bind/db.example.rtxlab.local";
    masters { 10.0.20.11; };
};

zone "X.Y.10.in-addr.arpa" {
    type slave;
    file "/var/cache/bind/db.X.Y.10";
    masters { 10.0.20.11; };
};
```

---

## Типы записей

### A Record (IPv4)

```bind
webserver       IN      A       10.0.20.50

; Round-robin (несколько IP)
www             IN      A       10.0.20.51
www             IN      A       10.0.20.52
```

### CNAME Record (Алиас)

```bind
; Всегда с точкой в конце!
www             IN      CNAME   webserver.k8s.rtxlab.local.
ftp             IN      CNAME   webserver.k8s.rtxlab.local.
```

### PTR Record (Обратная)

```bind
; В файле обратной зоны
50      IN      PTR     webserver.k8s.rtxlab.local.
```

### Wildcard

```bind
; Любой поддомен *.apps → ingress
*.apps          IN      A       10.0.20.26

; Или через CNAME
*.apps          IN      CNAME   ingress.k8s.rtxlab.local.
```

### MX Record (Почта)

```bind
@               IN      MX      10      mail.rtxlab.local.
@               IN      MX      20      mail2.rtxlab.local.
```

### TXT Record

```bind
@               IN      TXT     "v=spf1 mx -all"
```

### SRV Record

```bind
_http._tcp      IN      SRV     0   5   80   webserver.k8s.rtxlab.local.
```

---

## named.conf.options — Полная версия

```c
acl "trusted" {
    localhost;
    10.0.10.0/24;    // Management
    10.0.20.0/24;    // Services
    10.0.30.0/24;    // Storage
    10.0.40.0/24;    // IoT
    10.0.50.0/24;    // DMZ
};

options {
    directory "/var/cache/bind";

    listen-on { any; };
    listen-on-v6 { none; };

    allow-query { trusted; };

    recursion yes;
    allow-recursion { trusted; };

    forwarders {
        1.1.1.1;
        8.8.8.8;
    };

    dnssec-validation no;

    allow-transfer { 10.0.20.12; };
    notify yes;

    auth-nxdomain no;

    // Опционально
    max-cache-size 256M;
    version "Not Available";
};
```

---

## Добавление новой зоны

### На Master (dns-01)

```bash
# 1. Создать файл зоны
sudo nano /etc/bind/zones/db.newzone.rtxlab.local

# 2. Добавить в named.conf.local
sudo nano /etc/bind/named.conf.local
```

```c
zone "newzone.rtxlab.local" {
    type master;
    file "/etc/bind/zones/db.newzone.rtxlab.local";
    allow-transfer { 10.0.20.12; };
    notify yes;
};
```

```bash
# 3. Проверить и применить
sudo named-checkzone newzone.rtxlab.local /etc/bind/zones/db.newzone.rtxlab.local
sudo named-checkconf
sudo rndc reload
```

### На Slave (dns-02)

```bash
sudo nano /etc/bind/named.conf.local
```

```c
zone "newzone.rtxlab.local" {
    type slave;
    file "/var/cache/bind/db.newzone.rtxlab.local";
    masters { 10.0.20.11; };
};
```

```bash
sudo named-checkconf
sudo rndc reload
sudo rndc retransfer newzone.rtxlab.local
```

---

Дата создания: 02-12-2025 18:22

#### Ссылки:

[[21.04.00 DNS]]
[[21.04.01 BIND9 Полное руководство]]
