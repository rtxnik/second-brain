# 21.07.00 Автоматизация

> Инструменты автоматизации инфраструктуры

## Содержание

| Заметка               | Описание                           |
| --------------------- | ---------------------------------- |
| [[21.07.01 OpenTofu]] | Infrastructure as Code для Proxmox |
| [[21.07.02 Ansible]]  | Configuration management           |

---

## Стек автоматизации

```
┌─────────────────────────────────────────────────────────────┐
│                    Automation Stack                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│   │  OpenTofu   │  │   Ansible   │  │  Kubespray  │        │
│   │             │  │             │  │             │        │
│   │ VM Creation │  │   Config    │  │  K8s Deploy │        │
│   │ Proxmox API │  │  Management │  │   Ansible   │        │
│   └──────┬──────┘  └──────┬──────┘  └──────┬──────┘        │
│          │                │                │                │
│          └────────────────┼────────────────┘                │
│                           │                                 │
│                           ▼                                 │
│   ┌─────────────────────────────────────────────────────┐  │
│   │              Infrastructure                          │  │
│   │   Proxmox → VMs → Kubernetes → Services             │  │
│   └─────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Workflow

### Создание VM

```
1. OpenTofu → Proxmox API
   - Clone template
   - Set resources (CPU, RAM, Disk)
   - Configure network (VLAN, IP)
   - Cloud-init (hostname, SSH keys)

2. Ansible → VM Configuration
   - Base packages
   - Users and SSH
   - Firewall rules
   - Specific roles
```

### Деплой Kubernetes

```
1. OpenTofu → Create K8s VMs
2. Kubespray (Ansible) → Deploy cluster
3. Helm/ArgoCD → Deploy services
```

---

## Репозитории

| Репозиторий       | Назначение                        |
| ----------------- | --------------------------------- |
| `homelab-tofu`    | OpenTofu конфигурации             |
| `homelab-ansible` | Ansible playbooks и roles         |
| `homelab-k8s`     | Kubernetes manifests, Helm values |

---

## DevPod

Все инструменты запускаются из DevPod контейнера:

```bash
# Установленные инструменты
- opentofu
- ansible
- kubectl
- helm
- k9s
- gping
```

---

## Статус

- [x] OpenTofu настроен
- [x] Proxmox provider работает
- [ ] Ansible playbooks готовы
- [ ] VM templates автоматизированы
- [ ] Full pipeline протестирован

---

Дата создания: 02-12-2025 18:22

#### Ссылки:

[[21.00 Homelab]]
[[21.03.03 VM Templates]]
