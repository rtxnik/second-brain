# 21.06.00 Сервисы

> Сервисы и приложения в homelab

## Содержание

| Заметка | Описание        |
| ------- | --------------- |
| -       | Будущие сервисы |

---

## Планируемые сервисы

### Инфраструктура

| Сервис       | Назначение      | Кластер | Статус |
| ------------ | --------------- | ------- | ------ |
| ArgoCD       | GitOps          | Оба     | [ ]    |
| Prometheus   | Мониторинг      | Оба     | [ ]    |
| Grafana      | Визуализация    | Оба     | [ ]    |
| Loki         | Логирование     | Оба     | [ ]    |
| Longhorn     | Storage         | Оба     | [ ]    |
| MetalLB      | LoadBalancer    | Оба     | [ ]    |
| cert-manager | TLS сертификаты | Оба     | [ ]    |

### Приложения

| Сервис         | Назначение         | Кластер | Статус |
| -------------- | ------------------ | ------- | ------ |
| Gitea / GitLab | Git репозитории    | Prod    | [ ]    |
| Nextcloud      | Файловое хранилище | Prod    | [ ]    |
| Vaultwarden    | Password manager   | Prod    | [ ]    |
| Home Assistant | Умный дом          | Prod    | [ ]    |
| Jellyfin       | Media server       | Prod    | [ ]    |

---

## Архитектура сервисов

```
┌─────────────────────────────────────────────────────────────┐
│                     External Access                          │
│                    *.apps.prod/test                          │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                   NGINX Ingress Controller                   │
│                   (k8s-prod/test-ingress-1)                  │
└──────────────────────────┬──────────────────────────────────┘
                           │
        ┌──────────────────┼──────────────────┐
        │                  │                  │
        ▼                  ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│   ArgoCD     │  │   Grafana    │  │   Apps...    │
│  /argocd     │  │  /grafana    │  │  /app-name   │
└──────────────┘  └──────────────┘  └──────────────┘
```

---

## GitOps Workflow

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   GitLab    │────▶│   ArgoCD    │────▶│ K8s Cluster │
│   (Git)     │     │  (Sync)     │     │  (Deploy)   │
└─────────────┘     └─────────────┘     └─────────────┘
       │                                       │
       │              ┌─────────────┐          │
       └─────────────▶│ Helm Charts │◀─────────┘
                      └─────────────┘
```

---

## Приоритеты развёртывания

### Фаза 1: Базовая инфраструктура

1. MetalLB (LoadBalancer для bare-metal)
2. NGINX Ingress Controller
3. cert-manager (Let's Encrypt или self-signed)
4. Longhorn (Persistent Storage)

### Фаза 2: Observability

1. Prometheus + Node Exporter
2. Grafana + Dashboards
3. Loki + Promtail

### Фаза 3: GitOps

1. ArgoCD
2. Sealed Secrets или External Secrets

### Фаза 4: Приложения

1. Выбранные приложения по приоритету

---

## Namespaces

```yaml
# Структура namespaces
namespaces:
  - kube-system # Системные компоненты K8s
  - ingress-nginx # Ingress Controller
  - metallb-system # MetalLB
  - cert-manager # Сертификаты
  - longhorn-system # Storage
  - monitoring # Prometheus, Grafana
  - logging # Loki
  - argocd # GitOps
  - apps # Пользовательские приложения
```

---

## Helm репозитории

```bash
# Добавление репозиториев
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo add jetstack https://charts.jetstack.io
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo add grafana https://grafana.github.io/helm-charts
helm repo add argo https://argoproj.github.io/argo-helm
helm repo add longhorn https://charts.longhorn.io

helm repo update
```

---

## Статус

- [ ] MetalLB установлен
- [ ] Ingress Controller установлен
- [ ] cert-manager установлен
- [ ] Longhorn установлен
- [ ] Monitoring stack готов
- [ ] ArgoCD установлен

---

Дата создания: 02-12-2025 18:22

#### Ссылки:

[[21.00 Homelab]]
[[21.05.00 Kubernetes]]
