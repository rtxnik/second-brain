# 34.01.22 Loops

Loops позволяют выполнять задачу несколько раз с разными данными.

## Простые циклы

```yaml
- name: "Install packages"
  ansible.builtin.apt:
    name: "{{ item }}"
    state: present
  loop:
    - nginx
    - mysql-server
    - php-fpm

- name: "Create users"
  ansible.builtin.user:
    name: "{{ item }}"
    shell: /bin/bash
  loop:
    - alice
    - bob
```

## Циклы по словарям

```yaml
- name: "Create users with settings"
  ansible.builtin.user:
    name: "{{ item.name }}"
    shell: "{{ item.shell | default('/bin/bash') }}"
    groups: "{{ item.groups | default([]) }}"
  loop:
    - { name: "admin", shell: "/bin/bash", groups: ["sudo"] }
    - { name: "developer", shell: "/bin/zsh" }
```

## Фильтрация

```yaml
- name: "Process only active users"
  ansible.builtin.user:
    name: "{{ item.name }}"
  loop: "{{ users | selectattr('active', 'equalto', true) | list }}"
```

## Оптимизация

```yaml
# Хорошо — один вызов модуля
- name: "Install packages"
  ansible.builtin.apt:
    name:
      - nginx
      - mysql-server
      - php-fpm
    state: present
```

---

Дата создания: 2025-12-01
Ссылки:

[[34.01.00 Ansible]]
[[34.01.15 Tasks]]
[[34.01.21 Conditionals]]
