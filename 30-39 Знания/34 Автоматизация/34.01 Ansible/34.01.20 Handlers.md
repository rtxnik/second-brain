# 34.01.20 Handlers

Ansible Handlers — специальные задачи, выполняемые только при изменениях.

## Принцип работы

Handler выполняется только если:
1. Задача с `notify` завершилась с "changed"
2. Play выполнился без критических ошибок
3. Handlers выполняются в конце play

## Базовое использование

```yaml
handlers:
  - name: restart nginx
    ansible.builtin.service:
      name: nginx
      state: restarted

tasks:
  - name: "Deploy nginx config"
    ansible.builtin.template:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf
    notify: restart nginx
```

## Группировка handlers

```yaml
handlers:
  - name: restart web services
    ansible.builtin.service:
      name: nginx
      state: restarted
    listen: "restart web stack"
    
  - name: restart php-fpm
    ansible.builtin.service:
      name: php-fpm
      state: restarted
    listen: "restart web stack"
```

## Немедленное выполнение

```yaml
- name: "Update configuration"
  ansible.builtin.template:
    src: app.conf.j2
    dest: /etc/myapp/app.conf
  notify: restart app
  
- name: "Force handler execution"
  ansible.builtin.meta: flush_handlers
```

---

Дата создания: 2025-12-01

Ссылки:

[[34.01.00 Ansible]]
[[34.01.13 Playbook]]
[[34.01.15 Tasks]]
